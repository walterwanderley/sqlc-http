// Code generated by sqlc-http (https://github.com/walterwanderley/sqlc-http). DO NOT EDIT.

package {{.Package}}

import (
	"context"
	"database/sql"
	"encoding/json"
	"fmt"
	"log/slog"
	"net"
	"net/http"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5"
	"github.com/jackc/pgx/v5/pgtype"
	"github.com/jackc/pgx/v5/pgxpool"

	"{{ .GoModule}}/internal/validation"
)
	
type Service struct {
	querier {{if .EmitInterface}}Querier{{else}}*Queries{{end}}
	{{if .EmitDbArgument}}db {{if eq .SqlPackage "pgx/v5"}}*pgxpool.Pool{{else}}*sql.DB{{end}}{{end}}
}

func NewService(querier {{if .EmitInterface}}Querier{{else}}*Queries{{end}}{{if .EmitDbArgument}}, db {{if eq .SqlPackage "pgx/v5"}}*pgxpool.Pool{{else}}*sql.DB{{end}}{{end}}) *Service {
	return &Service{querier: querier{{if .EmitDbArgument}}, db: db{{end}}}
}

{{$emitDbArgument := .EmitDbArgument}}
{{ range .Services }}
func (s *Service) handle{{.Name | UpperFirstCharacter}}() http.HandlerFunc {
	{{ range . | HandlerTypes}}{{ .}}
	{{end}}
	return func(w http.ResponseWriter, r *http.Request) {
		{{ range . | Input}}{{ .}}
		{{end}}
		{{if not .EmptyOutput}}result, {{end}}err := s.querier.{{ .Name}}(r.Context(){{if $emitDbArgument}}, s.db{{end}}{{ .ParamsCallDatabase}})
		if err != nil {
			slog.Error("sql call failed", "error", err, "method", "{{.Name}}")
			http.Error(w, err.Error(), http.StatusInternalServerError)	
			return
		}
		{{ range . | Output}}{{ .}}
		{{end -}}
	}
}
{{ end }}
